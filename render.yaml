services:
  - type: web
    name: ai-recommendation-server
    env: python
    region: singapore
    plan: starter
    buildCommand: pip install --upgrade pip setuptools wheel && pip install --default-timeout=300 --retries=5 --no-cache-dir -r requirements.txt
    startCommand: gunicorn --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120 src.ai_server:app
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DATABASE_URL
        sync: false
      # Alternative: Use individual DB variables if DATABASE_URL is not set
      - key: DB_HOST
        sync: false
      - key: DB_PORT
        sync: false
      - key: DB_NAME
        sync: false
      - key: DB_USER
        sync: false
      - key: DB_PASSWORD
        sync: false
      - key: MODEL_SAVE_PATH
        value: ./models
      - key: AI_SERVER_HOST
        value: 0.0.0.0
      - key: BATCH_SIZE
        value: 32
      - key: EPOCHS
        value: 50
      - key: LEARNING_RATE
        value: 0.001
      - key: MAX_RECOMMENDATIONS
        value: 10
      - key: RECOMMENDATION_EXPIRY_HOURS
        value: 24
      - key: MIN_INTERACTIONS_PER_USER
        value: 5
      - key: MIN_INTERACTIONS_PER_ITEM
        value: 3
      - key: TRAIN_TEST_SPLIT
        value: 0.8
      - key: COLLABORATIVE_WEIGHT
        value: 0.6
      - key: CONTENT_BASED_WEIGHT
        value: 0.4
      - key: AI_SERVER_URL
        fromService:
          type: web
          name: ai-recommendation-server
          property: host
      - key: TRAINING_INTERVAL_MINUTES
        value: 15
      - key: RECOMMENDATION_INTERVAL_MINUTES
        value: 5
      - key: ENABLE_SCHEDULER
        value: "true"
